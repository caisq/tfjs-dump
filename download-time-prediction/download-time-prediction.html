<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>title</title>
  </head>
  <body>
    <div>
      <button id="start-measurement">Start measurement</button>
    </div>
    <div>
      <textarea readonly="true" id="data-display" rows="20"></textarea>
    </div>
    <div id="plot-div"></div>
    <div>
      <button id="train">Train model</button>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <script>
      const FILE_SIZES_KB =
          [1, 2, 5, 8, 10, 20, 50, 80, 100, 200, 500, 800, 1000, 2000, 4000,
           5000, 6000, 7000, 8000, 9000, 10000];
      const RUNS_PER_SIZE = 10;
      const FILE_URL_PREFIX =
        'https://storage.googleapis.com/tfjs-examples/download-time-prediction/files/'
      const FILE_URL_SUFFIX = '-kb';

      // Format: Array<[fileSize, timeMillis]>;
      const dataPoints = [];

      const startMeasurementButton = document.getElementById('start-measurement');
      const dataDisplay = document.getElementById('data-display');
      const plotDiv = document.getElementById('plot-div');

      startMeasurementButton.addEventListener('click', async () => {
        // Randomize the download schedule.
        let downloadSchedule = [];
        for (let i = 0; i < RUNS_PER_SIZE; ++i) {
          downloadSchedule.push(...FILE_SIZES_KB);
        }
        downloadSchedule = _.shuffle(downloadSchedule);
        console.log(downloadSchedule);

        for (let i = 0; i < downloadSchedule.length; ++i) {
          const fileSizeKb = downloadSchedule[i];
          const downloadURL = `${FILE_URL_PREFIX}${fileSizeKb}${FILE_URL_SUFFIX}`;
          dataDisplay.textContent =
              `Measuring ${i + 1} of ${downloadSchedule.length}: ${fileSizeKb}-kb`;
          const t0 = new Date().getTime();
          await (await fetch(downloadURL, {cache: 'no-store'})).text();
          const t1 = new Date().getTime();
          dataPoints.push([fileSizeKb, t1 - t0]);
        }

        dataDisplay.textContent = JSON.stringify(dataPoints, null, 2);
        plotData(dataPoints);
      });

      function plotData(dataPoints) {
        const data = {
          x: [],
          y: [],
          mode: 'markers',
          type: 'scatter'
        };
        for (const dataPoint of dataPoints) {
          data.x.push(dataPoint[0]);
          data.y.push(dataPoint[1]);
        }
        Plotly.plot(plotDiv, [data]);
      }

      const hardCodedData = [
        [
          80,
          135
        ],
        [
          9000,
          739
        ],
        [
          1,
          67
        ],
        [
          100,
          126
        ],
        [
          8000,
          646
        ],
        [
          5000,
          435
        ],
        [
          100,
          69
        ],
        [
          6000,
          497
        ],
        [
          50,
          68
        ],
        [
          500,
          116
        ],
        [
          2,
          70
        ],
        [
          2000,
          289
        ],
        [
          5,
          76
        ],
        [
          10000,
          744
        ],
        [
          10,
          83
        ],
        [
          7000,
          560
        ],
        [
          6000,
          480
        ],
        [
          5000,
          399
        ],
        [
          1000,
          153
        ],
        [
          1000,
          149
        ],
        [
          5000,
          425
        ],
        [
          200,
          98
        ],
        [
          1,
          52
        ],
        [
          9000,
          686
        ],
        [
          2,
          66
        ],
        [
          20,
          78
        ],
        [
          8,
          70
        ],
        [
          4000,
          375
        ],
        [
          1,
          58
        ],
        [
          1000,
          136
        ],
        [
          5,
          52
        ],
        [
          80,
          63
        ],
        [
          800,
          183
        ],
        [
          200,
          87
        ],
        [
          50,
          66
        ],
        [
          7000,
          558
        ],
        [
          5,
          66
        ],
        [
          2,
          68
        ],
        [
          8000,
          610
        ],
        [
          8,
          57
        ],
        [
          6000,
          494
        ],
        [
          200,
          79
        ],
        [
          10000,
          735
        ],
        [
          6000,
          506
        ],
        [
          10,
          72
        ],
        [
          4000,
          342
        ],
        [
          800,
          130
        ],
        [
          2000,
          201
        ],
        [
          8000,
          647
        ],
        [
          1,
          63
        ],
        [
          1000,
          141
        ],
        [
          100,
          64
        ],
        [
          7000,
          564
        ],
        [
          8000,
          610
        ],
        [
          100,
          73
        ],
        [
          8,
          69
        ],
        [
          10000,
          755
        ],
        [
          1000,
          134
        ],
        [
          5000,
          414
        ],
        [
          5,
          62
        ],
        [
          500,
          98
        ],
        [
          2000,
          210
        ],
        [
          10,
          68
        ],
        [
          1000,
          135
        ],
        [
          500,
          103
        ],
        [
          9000,
          727
        ],
        [
          10000,
          737
        ],
        [
          200,
          85
        ],
        [
          50,
          65
        ],
        [
          20,
          56
        ],
        [
          1,
          57
        ],
        [
          2000,
          217
        ],
        [
          7000,
          537
        ],
        [
          1,
          65
        ],
        [
          20,
          54
        ],
        [
          500,
          96
        ],
        [
          5,
          68
        ],
        [
          20,
          74
        ],
        [
          8000,
          718
        ],
        [
          7000,
          634
        ],
        [
          800,
          150
        ],
        [
          50,
          82
        ],
        [
          1,
          58
        ],
        [
          800,
          146
        ],
        [
          200,
          107
        ],
        [
          9000,
          668
        ],
        [
          4000,
          345
        ],
        [
          200,
          86
        ],
        [
          20,
          74
        ],
        [
          5000,
          434
        ],
        [
          7000,
          554
        ],
        [
          800,
          123
        ],
        [
          80,
          82
        ],
        [
          8,
          58
        ],
        [
          10,
          72
        ],
        [
          50,
          61
        ],
        [
          800,
          121
        ],
        [
          8000,
          589
        ],
        [
          80,
          70
        ],
        [
          6000,
          480
        ],
        [
          80,
          66
        ],
        [
          100,
          85
        ],
        [
          50,
          66
        ],
        [
          500,
          103
        ],
        [
          5000,
          408
        ],
        [
          7000,
          530
        ],
        [
          7000,
          543
        ],
        [
          9000,
          692
        ],
        [
          4000,
          351
        ],
        [
          9000,
          675
        ],
        [
          1,
          53
        ],
        [
          1000,
          129
        ],
        [
          80,
          79
        ],
        [
          8000,
          615
        ],
        [
          9000,
          680
        ],
        [
          5,
          62
        ],
        [
          10,
          56
        ],
        [
          500,
          96
        ],
        [
          10000,
          728
        ],
        [
          200,
          73
        ],
        [
          5,
          66
        ],
        [
          2000,
          221
        ],
        [
          5000,
          422
        ],
        [
          4000,
          352
        ],
        [
          2,
          54
        ],
        [
          20,
          76
        ],
        [
          10,
          69
        ],
        [
          80,
          76
        ],
        [
          1000,
          138
        ],
        [
          5,
          63
        ],
        [
          7000,
          711
        ],
        [
          100,
          81
        ],
        [
          20,
          58
        ],
        [
          10000,
          723
        ],
        [
          7000,
          559
        ],
        [
          80,
          67
        ],
        [
          10000,
          738
        ],
        [
          800,
          127
        ],
        [
          2,
          57
        ],
        [
          20,
          60
        ],
        [
          8,
          59
        ],
        [
          8,
          62
        ],
        [
          8,
          69
        ],
        [
          50,
          59
        ],
        [
          10,
          56
        ],
        [
          2,
          60
        ],
        [
          2000,
          197
        ],
        [
          10,
          52
        ],
        [
          5,
          76
        ],
        [
          20,
          91
        ],
        [
          2,
          68
        ],
        [
          500,
          101
        ],
        [
          8,
          60
        ],
        [
          2,
          66
        ],
        [
          10000,
          735
        ],
        [
          5000,
          420
        ],
        [
          9000,
          698
        ],
        [
          8000,
          639
        ],
        [
          2000,
          423
        ],
        [
          9000,
          650
        ],
        [
          5000,
          413
        ],
        [
          8000,
          604
        ],
        [
          6000,
          467
        ],
        [
          9000,
          652
        ],
        [
          200,
          80
        ],
        [
          10,
          67
        ],
        [
          8,
          51
        ],
        [
          8,
          59
        ],
        [
          6000,
          528
        ],
        [
          50,
          60
        ],
        [
          100,
          260
        ],
        [
          1,
          58
        ],
        [
          20,
          59
        ],
        [
          80,
          76
        ],
        [
          1,
          65
        ],
        [
          10000,
          781
        ],
        [
          2000,
          217
        ],
        [
          10,
          56
        ],
        [
          5000,
          423
        ],
        [
          4000,
          360
        ],
        [
          500,
          92
        ],
        [
          2,
          47
        ],
        [
          4000,
          366
        ],
        [
          2000,
          194
        ],
        [
          6000,
          467
        ],
        [
          6000,
          491
        ],
        [
          6000,
          514
        ],
        [
          100,
          69
        ],
        [
          2000,
          212
        ],
        [
          8000,
          634
        ],
        [
          50,
          69
        ],
        [
          200,
          82
        ],
        [
          500,
          98
        ],
        [
          100,
          86
        ],
        [
          1000,
          143
        ],
        [
          2,
          54
        ],
        [
          4000,
          354
        ],
        [
          200,
          87
        ],
        [
          80,
          67
        ],
        [
          800,
          117
        ],
        [
          100,
          63
        ],
        [
          800,
          123
        ],
        [
          50,
          68
        ],
        [
          4000,
          372
        ],
        [
          5,
          61
        ],
        [
          4000,
          345
        ],
        [
          500,
          116
        ],
        [
          10000,
          739
        ],
        [
          800,
          120
        ],
        [
          1000,
          141
        ]
      ];
    </script>
  </body>
</html>

